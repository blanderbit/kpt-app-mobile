# Аутентификация

Модуль аутентификации интегрирован с KPT API и предоставляет полный функционал входа и выхода из системы.

## Компоненты

### LoginScreen
Главная страница входа в систему с формой логина и Apple Sign In.

**Особенности:**
- Валидация формы с помощью Yup
- Обработка ошибок API
- Индикаторы загрузки
- Автоматическая навигация после успешного входа

### AuthProvider
Контекстный провайдер для управления состоянием аутентификации.

**Функции:**
- Проверка токена при загрузке приложения
- Автоматический вход при наличии валидного токена
- Управление состоянием пользователя
- Обработка ошибок аутентификации

## Использование

### В компонентах

```tsx
import { useAuth } from '@app/hooks/auth.hook';

function MyComponent() {
  const { isAuthenticated, user, login, logout, isLoading, error } = useAuth();

  const handleLogin = async () => {
    try {
      await login('user@example.com', 'password123');
      // Пользователь автоматически перенаправится на главную страницу
    } catch (error) {
      console.error('Ошибка входа:', error);
    }
  };

  if (isLoading) {
    return <LoadingSpinner />;
  }

  if (isAuthenticated) {
    return <div>Добро пожаловать, {user?.firstName}!</div>;
  }

  return <LoginForm onLogin={handleLogin} />;
}
```

### API интеграция

Аутентификация полностью интегрирована с KPT API:

- **POST /auth/login** - Вход в систему
- **POST /auth/logout** - Выход из системы
- **GET /users/profile** - Получение данных пользователя
- **POST /auth/refresh** - Обновление токенов

### Безопасность

- Токены автоматически сохраняются в AsyncStorage
- Проверка валидности токена при загрузке приложения
- Автоматическая очистка недействительных токенов
- Защищенные маршруты на основе состояния аутентификации

## Настройка

Убедитесь, что в вашем приложении настроен AuthProvider:

```tsx
import { AuthProvider } from '@features/auth/AuthProvider';

function App() {
  return (
    <AuthProvider>
      <AppNavigator />
    </AuthProvider>
  );
}
```

## Обработка ошибок

Все ошибки аутентификации обрабатываются централизованно:

- Неверные учетные данные
- Проблемы с сетью
- Истекшие токены
- Ошибки сервера

Ошибки отображаются пользователю через Alert или ErrorMessage компонент.

## Состояния

- `isAuthenticated` - Авторизован ли пользователь
- `user` - Данные текущего пользователя
- `isLoading` - Выполняется ли операция аутентификации
- `error` - Текст ошибки (если есть)

## Навигация

После успешного входа пользователь автоматически перенаправляется на главную страницу приложения. При выходе - на страницу логина.
